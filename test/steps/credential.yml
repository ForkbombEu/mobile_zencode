name: Call token and credential endpoints
http:
  url: http://${{env.mz_host}}/call_token_and_credential
  method: POST
  json:
    credential_parameters:
      authorization_endpoint: ${{captures.credential_parameters.authorization_endpoint}}
      authorization_server_endpoint_par: ${{captures.credential_parameters.authorization_server_endpoint_par}}
      code_challenge_method: ${{captures.credential_parameters.code_challenge_method}}
      credential_endpoint: ${{captures.credential_parameters.credential_endpoint}}
      credential_issuer: ${{captures.credential_parameters.credential_issuer}}
      format: ${{captures.credential_parameters.format}}
      grant_type: ${{captures.credential_parameters.grant_type}}
      nonce_endpoint: ${{captures.credential_parameters.nonce_endpoint}}
      response_type: ${{captures.credential_parameters.response_type}}
      token_endpoint: ${{captures.credential_parameters.token_endpoint}}
      credential_configuration_id: ${{captures.credential_parameters.credential_configuration_id}}
    code: "${{captures.code | url_encode | remove_first: 'openid-credential-issuer%3A%2F%2Fexample.com%2F%3Fcode%3D' | url_decode}}"
    code_verifier: ${{captures.code_verifier}}
    redirect_uri: openid-credential-issuer://example.com/
  captures:
    credential:
      jsonpath: $.result.credentials[0].credential
  check:
    status: 200
    jsonpath:
      $.result.credentials[0].credential:
        - isDefined: true